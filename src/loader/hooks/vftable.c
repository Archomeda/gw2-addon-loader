#include "vftable.h"

D3DDevice9_vft GetVftD3DDevice9(const IDirect3DDevice9* const obj) {
    D3DDevice9_vft vft = { 0 };
    vft.QueryInterface = obj->lpVtbl->QueryInterface;
    vft.AddRef = obj->lpVtbl->AddRef;
    vft.Release = obj->lpVtbl->Release;
    vft.TestCooperativeLevel = obj->lpVtbl->TestCooperativeLevel;
    vft.GetAvailableTextureMem = obj->lpVtbl->GetAvailableTextureMem;
    vft.EvictManagedResources = obj->lpVtbl->EvictManagedResources;
    vft.GetDirect3D = obj->lpVtbl->GetDirect3D;
    vft.GetDeviceCaps = obj->lpVtbl->GetDeviceCaps;
    vft.GetDisplayMode = obj->lpVtbl->GetDisplayMode;
    vft.GetCreationParameters = obj->lpVtbl->GetCreationParameters;
    vft.SetCursorProperties = obj->lpVtbl->SetCursorProperties;
    vft.SetCursorPosition = obj->lpVtbl->SetCursorPosition;
    vft.ShowCursor = obj->lpVtbl->ShowCursor;
    vft.CreateAdditionalSwapChain = obj->lpVtbl->CreateAdditionalSwapChain;
    vft.GetSwapChain = obj->lpVtbl->GetSwapChain;
    vft.GetNumberOfSwapChains = obj->lpVtbl->GetNumberOfSwapChains;
    vft.Reset = obj->lpVtbl->Reset;
    vft.Present = obj->lpVtbl->Present;
    vft.GetBackBuffer = obj->lpVtbl->GetBackBuffer;
    vft.GetRasterStatus = obj->lpVtbl->GetRasterStatus;
    vft.SetDialogBoxMode = obj->lpVtbl->SetDialogBoxMode;
    vft.SetGammaRamp = obj->lpVtbl->SetGammaRamp;
    vft.GetGammaRamp = obj->lpVtbl->GetGammaRamp;
    vft.CreateTexture = obj->lpVtbl->CreateTexture;
    vft.CreateVolumeTexture = obj->lpVtbl->CreateVolumeTexture;
    vft.CreateCubeTexture = obj->lpVtbl->CreateCubeTexture;
    vft.CreateVertexBuffer = obj->lpVtbl->CreateVertexBuffer;
    vft.CreateIndexBuffer = obj->lpVtbl->CreateIndexBuffer;
    vft.CreateRenderTarget = obj->lpVtbl->CreateRenderTarget;
    vft.CreateDepthStencilSurface = obj->lpVtbl->CreateDepthStencilSurface;
    vft.UpdateSurface = obj->lpVtbl->UpdateSurface;
    vft.UpdateTexture = obj->lpVtbl->UpdateTexture;
    vft.GetRenderTargetData = obj->lpVtbl->GetRenderTargetData;
    vft.GetFrontBufferData = obj->lpVtbl->GetFrontBufferData;
    vft.StretchRect = obj->lpVtbl->StretchRect;
    vft.ColorFill = obj->lpVtbl->ColorFill;
    vft.CreateOffscreenPlainSurface = obj->lpVtbl->CreateOffscreenPlainSurface;
    vft.SetRenderTarget = obj->lpVtbl->SetRenderTarget;
    vft.GetRenderTarget = obj->lpVtbl->GetRenderTarget;
    vft.SetDepthStencilSurface = obj->lpVtbl->SetDepthStencilSurface;
    vft.GetDepthStencilSurface = obj->lpVtbl->GetDepthStencilSurface;
    vft.BeginScene = obj->lpVtbl->BeginScene;
    vft.EndScene = obj->lpVtbl->EndScene;
    vft.Clear = obj->lpVtbl->Clear;
    vft.SetTransform = obj->lpVtbl->SetTransform;
    vft.GetTransform = obj->lpVtbl->GetTransform;
    vft.MultiplyTransform = obj->lpVtbl->MultiplyTransform;
    vft.SetViewport = obj->lpVtbl->SetViewport;
    vft.GetViewport = obj->lpVtbl->GetViewport;
    vft.SetMaterial = obj->lpVtbl->SetMaterial;
    vft.GetMaterial = obj->lpVtbl->GetMaterial;
    vft.SetLight = obj->lpVtbl->SetLight;
    vft.GetLight = obj->lpVtbl->GetLight;
    vft.LightEnable = obj->lpVtbl->LightEnable;
    vft.GetLightEnable = obj->lpVtbl->GetLightEnable;
    vft.SetClipPlane = obj->lpVtbl->SetClipPlane;
    vft.GetClipPlane = obj->lpVtbl->GetClipPlane;
    vft.SetRenderState = obj->lpVtbl->SetRenderState;
    vft.GetRenderState = obj->lpVtbl->GetRenderState;
    vft.CreateStateBlock = obj->lpVtbl->CreateStateBlock;
    vft.BeginStateBlock = obj->lpVtbl->BeginStateBlock;
    vft.EndStateBlock = obj->lpVtbl->EndStateBlock;
    vft.SetClipStatus = obj->lpVtbl->SetClipStatus;
    vft.GetClipStatus = obj->lpVtbl->GetClipStatus;
    vft.GetTexture = obj->lpVtbl->GetTexture;
    vft.SetTexture = obj->lpVtbl->SetTexture;
    vft.GetTextureStageState = obj->lpVtbl->GetTextureStageState;
    vft.SetTextureStageState = obj->lpVtbl->SetTextureStageState;
    vft.GetSamplerState = obj->lpVtbl->GetSamplerState;
    vft.SetSamplerState = obj->lpVtbl->SetSamplerState;
    vft.ValidateDevice = obj->lpVtbl->ValidateDevice;
    vft.SetPaletteEntries = obj->lpVtbl->SetPaletteEntries;
    vft.GetPaletteEntries = obj->lpVtbl->GetPaletteEntries;
    vft.SetCurrentTexturePalette = obj->lpVtbl->SetCurrentTexturePalette;
    vft.GetCurrentTexturePalette = obj->lpVtbl->GetCurrentTexturePalette;
    vft.SetScissorRect = obj->lpVtbl->SetScissorRect;
    vft.GetScissorRect = obj->lpVtbl->GetScissorRect;
    vft.SetSoftwareVertexProcessing = obj->lpVtbl->SetSoftwareVertexProcessing;
    vft.GetSoftwareVertexProcessing = obj->lpVtbl->GetSoftwareVertexProcessing;
    vft.SetNPatchMode = obj->lpVtbl->SetNPatchMode;
    vft.GetNPatchMode = obj->lpVtbl->GetNPatchMode;
    vft.DrawPrimitive = obj->lpVtbl->DrawPrimitive;
    vft.DrawIndexedPrimitive = obj->lpVtbl->DrawIndexedPrimitive;
    vft.DrawPrimitiveUP = obj->lpVtbl->DrawPrimitiveUP;
    vft.DrawIndexedPrimitiveUP = obj->lpVtbl->DrawIndexedPrimitiveUP;
    vft.ProcessVertices = obj->lpVtbl->ProcessVertices;
    vft.CreateVertexDeclaration = obj->lpVtbl->CreateVertexDeclaration;
    vft.SetVertexDeclaration = obj->lpVtbl->SetVertexDeclaration;
    vft.GetVertexDeclaration = obj->lpVtbl->GetVertexDeclaration;
    vft.SetFVF = obj->lpVtbl->SetFVF;
    vft.GetFVF = obj->lpVtbl->GetFVF;
    vft.CreateVertexShader = obj->lpVtbl->CreateVertexShader;
    vft.SetVertexShader = obj->lpVtbl->SetVertexShader;
    vft.GetVertexShader = obj->lpVtbl->GetVertexShader;
    vft.SetVertexShaderConstantF = obj->lpVtbl->SetVertexShaderConstantF;
    vft.GetVertexShaderConstantF = obj->lpVtbl->GetVertexShaderConstantF;
    vft.SetVertexShaderConstantI = obj->lpVtbl->SetVertexShaderConstantI;
    vft.GetVertexShaderConstantI = obj->lpVtbl->GetVertexShaderConstantI;
    vft.SetVertexShaderConstantB = obj->lpVtbl->SetVertexShaderConstantB;
    vft.GetVertexShaderConstantB = obj->lpVtbl->GetVertexShaderConstantB;
    vft.SetStreamSource = obj->lpVtbl->SetStreamSource;
    vft.GetStreamSource = obj->lpVtbl->GetStreamSource;
    vft.SetStreamSourceFreq = obj->lpVtbl->SetStreamSourceFreq;
    vft.GetStreamSourceFreq = obj->lpVtbl->GetStreamSourceFreq;
    vft.SetIndices = obj->lpVtbl->SetIndices;
    vft.GetIndices = obj->lpVtbl->GetIndices;
    vft.CreatePixelShader = obj->lpVtbl->CreatePixelShader;
    vft.SetPixelShader = obj->lpVtbl->SetPixelShader;
    vft.GetPixelShader = obj->lpVtbl->GetPixelShader;
    vft.SetPixelShaderConstantF = obj->lpVtbl->SetPixelShaderConstantF;
    vft.GetPixelShaderConstantF = obj->lpVtbl->GetPixelShaderConstantF;
    vft.SetPixelShaderConstantI = obj->lpVtbl->SetPixelShaderConstantI;
    vft.GetPixelShaderConstantI = obj->lpVtbl->GetPixelShaderConstantI;
    vft.SetPixelShaderConstantB = obj->lpVtbl->SetPixelShaderConstantB;
    vft.GetPixelShaderConstantB = obj->lpVtbl->GetPixelShaderConstantB;
    vft.DrawRectPatch = obj->lpVtbl->DrawRectPatch;
    vft.DrawTriPatch = obj->lpVtbl->DrawTriPatch;
    vft.DeletePatch = obj->lpVtbl->DeletePatch;
    vft.CreateQuery = obj->lpVtbl->CreateQuery;
    return vft;
}

void SetVftD3DDevice9(IDirect3DDevice9* const obj, const D3DDevice9_vft vft) {
    DWORD protection = PAGE_READWRITE;
    if (VirtualProtect(obj->lpVtbl, sizeof(*obj->lpVtbl), protection, &protection)) {
        obj->lpVtbl->QueryInterface = vft.QueryInterface;
        obj->lpVtbl->AddRef = vft.AddRef;
        obj->lpVtbl->Release = vft.Release;
        obj->lpVtbl->TestCooperativeLevel = vft.TestCooperativeLevel;
        obj->lpVtbl->GetAvailableTextureMem = vft.GetAvailableTextureMem;
        obj->lpVtbl->EvictManagedResources = vft.EvictManagedResources;
        obj->lpVtbl->GetDirect3D = vft.GetDirect3D;
        obj->lpVtbl->GetDeviceCaps = vft.GetDeviceCaps;
        obj->lpVtbl->GetDisplayMode = vft.GetDisplayMode;
        obj->lpVtbl->GetCreationParameters = vft.GetCreationParameters;
        obj->lpVtbl->SetCursorProperties = vft.SetCursorProperties;
        obj->lpVtbl->SetCursorPosition = vft.SetCursorPosition;
        obj->lpVtbl->ShowCursor = vft.ShowCursor;
        obj->lpVtbl->CreateAdditionalSwapChain = vft.CreateAdditionalSwapChain;
        obj->lpVtbl->GetSwapChain = vft.GetSwapChain;
        obj->lpVtbl->GetNumberOfSwapChains = vft.GetNumberOfSwapChains;
        obj->lpVtbl->Reset = vft.Reset;
        obj->lpVtbl->Present = vft.Present;
        obj->lpVtbl->GetBackBuffer = vft.GetBackBuffer;
        obj->lpVtbl->GetRasterStatus = vft.GetRasterStatus;
        obj->lpVtbl->SetDialogBoxMode = vft.SetDialogBoxMode;
        obj->lpVtbl->SetGammaRamp = vft.SetGammaRamp;
        obj->lpVtbl->GetGammaRamp = vft.GetGammaRamp;
        obj->lpVtbl->CreateTexture = vft.CreateTexture;
        obj->lpVtbl->CreateVolumeTexture = vft.CreateVolumeTexture;
        obj->lpVtbl->CreateCubeTexture = vft.CreateCubeTexture;
        obj->lpVtbl->CreateVertexBuffer = vft.CreateVertexBuffer;
        obj->lpVtbl->CreateIndexBuffer = vft.CreateIndexBuffer;
        obj->lpVtbl->CreateRenderTarget = vft.CreateRenderTarget;
        obj->lpVtbl->CreateDepthStencilSurface = vft.CreateDepthStencilSurface;
        obj->lpVtbl->UpdateSurface = vft.UpdateSurface;
        obj->lpVtbl->UpdateTexture = vft.UpdateTexture;
        obj->lpVtbl->GetRenderTargetData = vft.GetRenderTargetData;
        obj->lpVtbl->GetFrontBufferData = vft.GetFrontBufferData;
        obj->lpVtbl->StretchRect = vft.StretchRect;
        obj->lpVtbl->ColorFill = vft.ColorFill;
        obj->lpVtbl->CreateOffscreenPlainSurface = vft.CreateOffscreenPlainSurface;
        obj->lpVtbl->SetRenderTarget = vft.SetRenderTarget;
        obj->lpVtbl->GetRenderTarget = vft.GetRenderTarget;
        obj->lpVtbl->SetDepthStencilSurface = vft.SetDepthStencilSurface;
        obj->lpVtbl->GetDepthStencilSurface = vft.GetDepthStencilSurface;
        obj->lpVtbl->BeginScene = vft.BeginScene;
        obj->lpVtbl->EndScene = vft.EndScene;
        obj->lpVtbl->Clear = vft.Clear;
        obj->lpVtbl->SetTransform = vft.SetTransform;
        obj->lpVtbl->GetTransform = vft.GetTransform;
        obj->lpVtbl->MultiplyTransform = vft.MultiplyTransform;
        obj->lpVtbl->SetViewport = vft.SetViewport;
        obj->lpVtbl->GetViewport = vft.GetViewport;
        obj->lpVtbl->SetMaterial = vft.SetMaterial;
        obj->lpVtbl->GetMaterial = vft.GetMaterial;
        obj->lpVtbl->SetLight = vft.SetLight;
        obj->lpVtbl->GetLight = vft.GetLight;
        obj->lpVtbl->LightEnable = vft.LightEnable;
        obj->lpVtbl->GetLightEnable = vft.GetLightEnable;
        obj->lpVtbl->SetClipPlane = vft.SetClipPlane;
        obj->lpVtbl->GetClipPlane = vft.GetClipPlane;
        obj->lpVtbl->SetRenderState = vft.SetRenderState;
        obj->lpVtbl->GetRenderState = vft.GetRenderState;
        obj->lpVtbl->CreateStateBlock = vft.CreateStateBlock;
        obj->lpVtbl->BeginStateBlock = vft.BeginStateBlock;
        obj->lpVtbl->EndStateBlock = vft.EndStateBlock;
        obj->lpVtbl->SetClipStatus = vft.SetClipStatus;
        obj->lpVtbl->GetClipStatus = vft.GetClipStatus;
        obj->lpVtbl->GetTexture = vft.GetTexture;
        obj->lpVtbl->SetTexture = vft.SetTexture;
        obj->lpVtbl->GetTextureStageState = vft.GetTextureStageState;
        obj->lpVtbl->SetTextureStageState = vft.SetTextureStageState;
        obj->lpVtbl->GetSamplerState = vft.GetSamplerState;
        obj->lpVtbl->SetSamplerState = vft.SetSamplerState;
        obj->lpVtbl->ValidateDevice = vft.ValidateDevice;
        obj->lpVtbl->SetPaletteEntries = vft.SetPaletteEntries;
        obj->lpVtbl->GetPaletteEntries = vft.GetPaletteEntries;
        obj->lpVtbl->SetCurrentTexturePalette = vft.SetCurrentTexturePalette;
        obj->lpVtbl->GetCurrentTexturePalette = vft.GetCurrentTexturePalette;
        obj->lpVtbl->SetScissorRect = vft.SetScissorRect;
        obj->lpVtbl->GetScissorRect = vft.GetScissorRect;
        obj->lpVtbl->SetSoftwareVertexProcessing = vft.SetSoftwareVertexProcessing;
        obj->lpVtbl->GetSoftwareVertexProcessing = vft.GetSoftwareVertexProcessing;
        obj->lpVtbl->SetNPatchMode = vft.SetNPatchMode;
        obj->lpVtbl->GetNPatchMode = vft.GetNPatchMode;
        obj->lpVtbl->DrawPrimitive = vft.DrawPrimitive;
        obj->lpVtbl->DrawIndexedPrimitive = vft.DrawIndexedPrimitive;
        obj->lpVtbl->DrawPrimitiveUP = vft.DrawPrimitiveUP;
        obj->lpVtbl->DrawIndexedPrimitiveUP = vft.DrawIndexedPrimitiveUP;
        obj->lpVtbl->ProcessVertices = vft.ProcessVertices;
        obj->lpVtbl->CreateVertexDeclaration = vft.CreateVertexDeclaration;
        obj->lpVtbl->SetVertexDeclaration = vft.SetVertexDeclaration;
        obj->lpVtbl->GetVertexDeclaration = vft.GetVertexDeclaration;
        obj->lpVtbl->SetFVF = vft.SetFVF;
        obj->lpVtbl->GetFVF = vft.GetFVF;
        obj->lpVtbl->CreateVertexShader = vft.CreateVertexShader;
        obj->lpVtbl->SetVertexShader = vft.SetVertexShader;
        obj->lpVtbl->GetVertexShader = vft.GetVertexShader;
        obj->lpVtbl->SetVertexShaderConstantF = vft.SetVertexShaderConstantF;
        obj->lpVtbl->GetVertexShaderConstantF = vft.GetVertexShaderConstantF;
        obj->lpVtbl->SetVertexShaderConstantI = vft.SetVertexShaderConstantI;
        obj->lpVtbl->GetVertexShaderConstantI = vft.GetVertexShaderConstantI;
        obj->lpVtbl->SetVertexShaderConstantB = vft.SetVertexShaderConstantB;
        obj->lpVtbl->GetVertexShaderConstantB = vft.GetVertexShaderConstantB;
        obj->lpVtbl->SetStreamSource = vft.SetStreamSource;
        obj->lpVtbl->GetStreamSource = vft.GetStreamSource;
        obj->lpVtbl->SetStreamSourceFreq = vft.SetStreamSourceFreq;
        obj->lpVtbl->GetStreamSourceFreq = vft.GetStreamSourceFreq;
        obj->lpVtbl->SetIndices = vft.SetIndices;
        obj->lpVtbl->GetIndices = vft.GetIndices;
        obj->lpVtbl->CreatePixelShader = vft.CreatePixelShader;
        obj->lpVtbl->SetPixelShader = vft.SetPixelShader;
        obj->lpVtbl->GetPixelShader = vft.GetPixelShader;
        obj->lpVtbl->SetPixelShaderConstantF = vft.SetPixelShaderConstantF;
        obj->lpVtbl->GetPixelShaderConstantF = vft.GetPixelShaderConstantF;
        obj->lpVtbl->SetPixelShaderConstantI = vft.SetPixelShaderConstantI;
        obj->lpVtbl->GetPixelShaderConstantI = vft.GetPixelShaderConstantI;
        obj->lpVtbl->SetPixelShaderConstantB = vft.SetPixelShaderConstantB;
        obj->lpVtbl->GetPixelShaderConstantB = vft.GetPixelShaderConstantB;
        obj->lpVtbl->DrawRectPatch = vft.DrawRectPatch;
        obj->lpVtbl->DrawTriPatch = vft.DrawTriPatch;
        obj->lpVtbl->DeletePatch = vft.DeletePatch;
        obj->lpVtbl->CreateQuery = vft.CreateQuery;
        VirtualProtect(obj->lpVtbl, sizeof(*obj->lpVtbl), protection, &protection);
    }
}
